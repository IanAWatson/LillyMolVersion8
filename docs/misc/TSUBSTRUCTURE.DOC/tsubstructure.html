<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<meta name="author" content="Ian Watson">
<title>tsubstructure</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
</head>
<body class="article">
<div id="header">
<h1><strong>tsubstructure</strong></h1>
<div class="details">
<span id="author" class="author">Ian Watson</span><br>
<span id="email" class="email"><a href="mailto:i.watson@lilly.com">i.watson@lilly.com</a></span><br>
<span id="revdate">Advanced Analytics</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_overview">Overview</a>
<ul class="sectlevel2">
<li><a href="#_smarts">Smarts</a></li>
<li><a href="#_smarts_extensions">Smarts Extensions</a></li>
<li><a href="#_bond_separation">Bond Separation</a></li>
<li><a href="#_query_file">Query file</a></li>
</ul>
</li>
<li><a href="#_conditions_on_matches_found">Conditions on Matches Found</a>
<ul class="sectlevel2">
<li><a href="#_max_matches_to_find">max_matches_to_find</a></li>
<li><a href="#_subtract_from_rc">subtract_from_rc</a></li>
<li><a href="#_ring_atoms_matched">ring_atoms_matched</a></li>
<li><a href="#_distance_between_hits">distance_between_hits</a></li>
<li><a href="#_fail_if_embeddings_too_close">fail_if_embeddings_too_close</a></li>
<li><a href="#_embeddings_to_not_overlap">embeddings_to_not_overlap</a></li>
<li><a href="#_min_fraction_atoms_matched_max_fraction_atoms_matched">min_fraction_atoms_matched, max_fraction_atoms_matched</a></li>
<li><a href="#_element_hits_needed">element_hits_needed</a></li>
</ul>
</li>
<li><a href="#_query_atoms">Query Atoms</a>
<ul class="sectlevel2">
<li><a href="#_preferences">Preferences</a></li>
</ul>
</li>
<li><a href="#_query_atom_specifications">Query Atom Specifications</a></li>
<li><a href="#_parallel">Parallel</a>
<ul class="sectlevel2">
<li><a href="#_tsubstructure_parallel">tsubstructure_parallel</a></li>
<li><a href="#_qsub_tsubstructure">qsub_tsubstructure</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_overview">Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>tsubstructure is a tool for performing substructure searches. Input can be any structure file
the underlying Molecule object can read. Output can be any supported file format.</p>
</div>
<div class="paragraph">
<p>Query specification will be either via smarts, molecule(s), or query file(s). These can
be mixed together.  Each has advantages and disadvantages.</p>
</div>
<div class="paragraph">
<p>By historical quirk, the default aromaticity definition is a very restrictive definition. Almost
all current use should add <code>-A D</code> to the invocation.</p>
</div>
<div class="paragraph">
<p>Substructure searching is made significantly easier if your input molecules are standardised.
Adding the <code>-g all</code> combination may make matching less surprising, although this whole area
is fraught and very complex.</p>
</div>
<div class="paragraph">
<p>Normally substructure searches are done without explicit Hydrogens, the <code>-g all</code> option will
remove any explicit Hydrogen atoms. Sometimes it may be convenient to have explicit
Hydrogen atoms. In that case, the option combination <code>-M imp2exp</code> will first convert
implicit Hydrogen atoms to explicit atoms. Once this is done, methane is now <code>[CD4]</code> rather
than <code>[CD1]</code>. This can be very tricky. Generally use either all implicit or all explicit
Hydrogen atoms.</p>
</div>
<div class="paragraph">
<p>Normally, molecules that match the query specification(s) will be written to the <code>-m</code> file. Optionally,
non matching molecules can be written to the <code>-n</code> stream. If neither is specified, tsubstructure will
perform the search, and report the number of matches. Adding -v options will provide increasing levels
of verbosity about the matching process.</p>
</div>
<div class="paragraph">
<p>If desired, the specific matched atoms can be identified with the -j option, which can attach
isotopic labels or atom map numbers.</p>
</div>
<div class="paragraph">
<p>Output can also be made as an array (<code>-a</code>) or as a fingerprint (<code>-J</code>). With array output, there will
be one column per query specified, whereas for fingerprint output, there will be one bit per query.
If the tag starts with <code>NC</code> then a non-colliding, sparse fingerprint will be produced. Via the <code>-M</code>
option there is the ability to control the number of bit replicates produced.</p>
</div>
<div class="paragraph">
<p>If multiple query specifications are entered, a match is achieved if any of the queries match.</p>
</div>
<div class="paragraph">
<p>By definition, many substructure searches will match multiple times - benzene will match itself 12 times.
Sometimes this is desirable, sometimes not. You can usually improve search speed by restricting searches
to just finding one embedding. This can be done with the <code>-f</code> option. For example, looking for <code>c1ccccc1</code>
in 100k random Pubchem molecules takes 2.3 seconds. With the -f option, that drops to 1.6 seconds. In this
particular case, 4 of those molecules had 120 matches.</p>
</div>
<div class="paragraph">
<p>Note that as matches are found, they are stored. If a large number of embeddings are encountered, this
can be expensive.</p>
</div>
<div class="paragraph">
<p>Sometimes you might need to find non symmetric matches. Using the <code>-k</code> option, benzene will not find only 6
matches when searching itself. Using the <code>-k</code> option, all matches are found, but those which are symmetry
related to previously found matches are discarded.</p>
</div>
<div class="paragraph">
<p>Substructure matching is done starting with the first atom in the substructure specification. The <code>-r</code> option
directs the search to move to another starting atom once it has found a match at a given atom - rather than
looking for further matches starting at that atom. Often this may yield results similar to what is obtained
with the -k option, but the -k option perceives symmetric atoms that are separated.</p>
</div>
<div class="paragraph">
<p>The <code>-R</code> option can be useful in summarising the overall results from a search.</p>
</div>
<div class="paragraph">
<p>Adding -v options will increase the level of verbosity with which tsubstructure reports results
and matching attempts. Adding three -v options will have it report how many atoms within a query
matched each target molecule. This can be helpful for debugging complex queries.</p>
</div>
<div class="paragraph">
<p>There are several ways in which a query can be specified to tsubstructure. Enter <code>-q help</code> for
details.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">smarts</dt>
<dd>
<p>Usually on the command line via the -s option <code>-s 'sss'</code>, or <code>-q SMARTS:ssss</code></p>
</dd>
<dt class="hdlist1">file of smarts</dt>
<dd>
<p><code>-q S:file</code></p>
</dd>
<dt class="hdlist1">query</dt>
<dd>
<p>Usually <code>-q file.qry</code></p>
</dd>
<dt class="hdlist1">file of query files</dt>
<dd>
<p>Usually <code>-q Q:file</code></p>
</dd>
<dt class="hdlist1">molecule</dt>
<dd>
<p>Usually <code>-q M:file</code>. File containing one or more molecules, or <code>-q smiles:&#8230;&#8203;.</code></p>
</dd>
<dt class="hdlist1">isis query</dt>
<dd>
<p>Usually <code>-q I:file</code>. Many, but not all ISIS substructure search concepts.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Note that single quotes are preferred for smarts on the command line, since the shell
will look inside double quotes.</p>
</div>
<div class="sect2">
<h3 id="_smarts">Smarts</h3>
<div class="paragraph">
<p>tsubstructure supports most smarts directives. See the Daylight theory manual.
<a href="http://www.daylight.com/dayhtml/doc/theory/theory.smarts.html" class="bare">http://www.daylight.com/dayhtml/doc/theory/theory.smarts.html</a>. Recursive
smarts are also supported, although complete compatibility is not guaranteed.
Additionally some local extensions to smarts are supported.</p>
</div>
</div>
<div class="sect2">
<h3 id="_smarts_extensions">Smarts Extensions</h3>
<div class="paragraph">
<p>Several useful extensions to smarts have been implemented.</p>
</div>
<div class="sect3">
<h4 id="_atomic_property_logical_operators">Atomic Property Logical Operators</h4>
<div class="paragraph">
<p>Whereas standard smarts allows specification of various atomic properties, tsubstructure
allows relational operators for many atomic attributes. In standard smarts, if you needed
to specify a 3 or 4 connected aliphatic carbon atom, you might need to specify <code>[C;D3,D4]</code>,
whereas tsubstructure allows <code>[CD&gt;2]</code>. Most atomic smarts directives can also be given
with a <code>&lt;</code> or <code>&gt;</code> qualifier.</p>
</div>
</div>
<div class="sect3">
<h4 id="_control_number_of_matches">Control Number of Matches</h4>
<div class="paragraph">
<p>If a smarts begins with a number, or a relational, that is interpreted as controlling the
number of matches desired. So, <code>-s 1N</code> would only match molecules containing exactly one
alipathic nitrogen atom. Similarly, <code>-s 0N</code> would match all molecules which do NOT contain
an aliphatic Nitrogen. The smarts <code>-s &gt;1N</code> will match molecules that contain two or more
aliphatic Nitrogen atoms. The &lt; operator is also supported.</p>
</div>
</div>
<div class="sect3">
<h4 id="_logical_operations">Logical Operations</h4>
<div class="paragraph">
<p>On the command line, a smarts can consist of multiple smarts components, joined via
relational operations. The operator and, <code>&amp;&amp;</code>, or <code>||</code>, and xor <code>^^</code> are supported.
So, a molecule containing precisely one primary amine and no acids might be specified as
<code>-s '1[ND1H2]-[CX4T1]&amp;&amp;0[OH]-[C,S]=O'</code>. In this case, we introduce another local
extension, the atomic T operator. This means one attached heteroatom.</p>
</div>
<div class="paragraph">
<p>The daylight low priority and operator is also supported, so</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  n1ccc2ccccc12||Cl-c;;[ND1]c1ccccc1</pre>
</div>
</div>
<div class="paragraph">
<p>would be find molecules that contain (either a benzimidazole or an aromatic Chlorine) <strong>and</strong>
an aniline. Molecules like</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./Images/low_priority_and_00001.png" alt="LowPrirotyAmd1" width="380" height="340"></span>
<span class="image"><img src="./Images/low_priority_and_00002.png" alt="LowPrirotyAmd2" width="380" height="340"></span></p>
</div>
<div class="paragraph">
<p>It is important to note that the components of a logical operation like this are separate,
independent queries, as can be seen in the example above - the aniline overlaps with
the benzimidazole, the Cl-c overlaps with the aniline. Contrast this with smarts
that use the no bond specifier <strong>.</strong> to
designate no bond between query atoms. In that case, all query atoms must match different
atoms in the molecule. So, ethanol, <strong>CCO</strong>, would be matched by the smarts <code>CC&amp;&amp;CO</code>, but <strong>not</strong>
by the smarts <code>CC.CO</code>.</p>
</div>
<div class="paragraph">
<p>In the earlier example of benzimidazole, aromatic Chlorine and aniline, if you required
them all to be separate parts of the molecule, the smarts</p>
</div>
<div class="listingblock">
<div class="content">
<pre>n1ccc2ccccc12.[ND1]c1ccccc1||Cl-c.[ND1]c1ccccc1</pre>
</div>
</div>
<div class="paragraph">
<p>would work.</p>
</div>
</div>
<div class="sect3">
<h4 id="_single_letter_extensions">Single Letter Extensions</h4>
<div class="paragraph">
<p>Certain atomic extensions to smarts are available via single letter directives.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attached Heteroatom Count</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">G</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsaturation</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>which again can all be used with relational qualifiers.</p>
</div>
<div class="paragraph">
<p>The <code>T</code> directive is particularly useful when handling a common concept used
by Chemists, where they will say that 'can be Carbon or Hydrogen only'. This
can be very difficult, because normally Hydrogens are implicit. In essence
what they are saying is there should not be a heteroatom at this location.
Usually this can be easily handled via the <code>T</code> directive on the central atom.
For example, a primary amine might be specified as <code>[NH2]-[CX4T1]</code>, which means
an NH2 group, attached to a fully saturated carbon atom, that is attached
to just one heteroatom, the Nitrogen atom.</p>
</div>
<div class="paragraph">
<p>The <code>G</code> directive is useful if you need to specify a fully saturated atom,
regardless of element. Without this, you might need to specify something like
<code>[CX4,NX3,NX4+,OX2]</code> rather than <code>[G0]</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bond_separation">Bond Separation</h3>
<div class="paragraph">
<p>The <code>&#8230;&#8203;</code> directive is interpreted as no matched atoms betweenbetween. Therefore
the smarts <code>[OD2]-C(=O)&#8230;&#8203;C(=O)[OD2]</code> will match the molecule</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./Images/dotdotdot1_00001.png" alt="DotDotDot1" width="400" height="300"></span>
But not
<span class="image"><img src="./Images/dotdotdot2_00001.png" alt="DotDotDot2" width="400" height="300"></span></p>
</div>
<div class="paragraph">
<p>The <code>&#8230;&#8203;</code> specifier can be coupled with a range of <strong>atoms</strong>, so the smarts
<code>Cl-c&#8230;&#8203;{5-9}c-[OH]</code> will match molecules like</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./Images/dotdotdot3_00001.png" alt="DotDotDot3" width="500" height="400"></span></p>
</div>
<div class="paragraph">
<p>The numerical qualifier is the number of non-matched <strong>atoms</strong> between
the two matched atoms at either end.</p>
</div>
<div class="sect3">
<h4 id="_iw_directives">IW Directives</h4>
<div class="paragraph">
<p>Unfortunately (actually fortunately for us) there are a finite number
of letters in the alphabet, and adding new directives via letters was
clearly not going to work.  To gain increased flexibility, we
introduce a prefix that can then be used to introduce various other,
multi-letter directives.  The prefix is <code>/IW</code>.  The following
qualifiers are recognised</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 87.5%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Ar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Atom is adjacent to a Aryl type atom (but not aromatic itself)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Vy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Atom is adjacent to a Vinyl type atom (but not Vinyl itself)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fss</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fused system size. Benzene is 1, naphthalene is 2, etc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fsid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fused system identifier</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ring identifier</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Atom must be part of the molecular spinach - substituents</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Atom must be in a ring with this many heteroatoms</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rscb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scaffold bonds attached to a ring</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>symd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Symmetry Degree</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>symg</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Symmetry Group Identifier</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Kl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Atom must be in a Kekule type aromatic ring</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Nv</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify numeric value for atom</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>x</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do NOT include this atom in the set of matched atoms reported.</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_ar">Ar</h5>
<div class="paragraph">
<p>A Nitrogen atom that is NOT adjacent to an aliphatic ring could be <code>[/IWAr0N]</code>. This
directive is seldom used in the positive sense, since '[NH2]-a' is a simple way of
specifying a Nitrogen atom that is next to an aromatic ring.</p>
</div>
</div>
<div class="sect4">
<h5 id="_vy">Vy</h5>
<div class="paragraph">
<p>Very similar to the Ar directive. A Vinyl group is something that has a non-single bond,
but which is not aromatic. The alternative would be <code>[&#8230;&#8203;][G0]</code>, indicating an atom,
attached to a fully saturated atom. Again, this directive is usually used as a negative
selector.</p>
</div>
</div>
<div class="sect4">
<h5 id="_fss">fss</h5>
<div class="paragraph">
<p>The Fused System Size directive allows specifying the number of rings in the system
being matched. Benzene is size 1, naphthalene is size 2. Whether good or bad, spiro
fused ring systems to NOT grow a fused system. It is unclear what correct should be.</p>
</div>
</div>
<div class="sect4">
<h5 id="_rid">rid</h5>
<div class="paragraph">
<p>The Ring Identifier directive allows you to specify that two matched atoms must be
in the same ring, or not in the same ring. The rid directive is followed by a digit.
Matched atoms that have the same digit, must be in the same ring. Matched atoms
that have different digits, must not be in the same ring.
Two chain atoms each with <code>/IWrid1</code> will not match - there is no ring that
contains both of these atoms. But two chain atoms <code>[/IWrid1].[/IWrid2]</code> will match -
again because there is no ring that contains both atoms.</p>
</div>
</div>
<div class="sect4">
<h5 id="_spch">spch</h5>
<div class="paragraph">
<p>To identify an atom that is not part of the scaffold, specify <code>[/IWspch0]</code>. Use
a value of 1 for atoms that must be part of the scaffold.</p>
</div>
</div>
<div class="sect4">
<h5 id="_hr">hr</h5>
<div class="paragraph">
<p>Also recognised as <code>rh</code>. Number of heteratoms in the same ring as the matched atom.
Note that if an atom is in multiple rings, it will check all possible rings for
a match.</p>
</div>
</div>
<div class="sect4">
<h5 id="_rscb">rscb</h5>
<div class="paragraph">
<p>Useful for identifying terminal rings. A terminal ring will have only one bond
to the molecular scaffold. So, <code>F-[/IWrscb&gt;1c]</code> identifies a Fluorine atom
attached to an 'inner' aromatic ring.</p>
</div>
</div>
<div class="sect4">
<h5 id="_symmd">symmd</h5>
<div class="paragraph">
<p>Degree of symmetry. Number of atoms in the molecule that are symmetric with the
matched atom</p>
</div>
</div>
<div class="sect4">
<h5 id="_symg">symg</h5>
<div class="paragraph">
<p>Allows you to specify that groups of matched atoms must be symmetric with
each other. The directive is followed by a digit indicating a symmetry grouping.
Atoms with the same digit must be symmetric in the molecule.</p>
</div>
</div>
<div class="sect4">
<h5 id="_kl">Kl</h5>
<div class="paragraph">
<p>ALlows specifying that a matched atom must be in a ring wit differing Kekule forms.
So, <code>[/IWKl0a]</code> will match pyrrole and furan atomatic rings, whereas <code>[/IWKl1a]</code> will
only match rings like benzene and pyridine, etc..</p>
</div>
</div>
<div class="sect4">
<h5 id="_nv">Nv</h5>
<div class="paragraph">
<p>Substructure atoms can have associated numeric values. Arbitrary floating point values can
be specified. This is only useful if the application is set up to handle these values</p>
</div>
</div>
<div class="sect4">
<h5 id="_x">x</h5>
<div class="paragraph">
<p>Do NOT include this atom in the Set_of_Atoms object(s) that are returned by the
substructure matching process. This can be useful when trying to be more specific about a
match condition.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_arbitrary_elements">Arbitrary Elements</h4>
<div class="paragraph">
<p>Using a combination of <code>-E autocreate -E anylength</code> arbitrary element names are possible.
If substructure searching were attempted with such elements, impossible situations could
result. For example, if element R has been created, how should smarts <code>[R]</code> be interpreted?
Arbitrary elements can be searched using <code>#{Foo}</code> as smarts. In this particular case,
we could search for <code>[#{R}R]</code> which would look for element R when it is in a ring.
Text within the braces is added to the list of known elements and will be matched
to any other instances of that element.</p>
</div>
</div>
<div class="sect3">
<h4 id="_query_molecule">Query Molecule</h4>
<div class="paragraph">
<p><code>tsubstructure</code> can create a match query from a molecule. In this case the query is
specified as <code>-q M:fname</code>, where fname contain the query molecule. Converting a
molecule to a query is not trivial. When given a molecule as a query, <code>tsubstructure</code>
will make an attempt to conver the molecule to a query. There is a separate tool, <code>mol2qry</code>
which is specifically set up to convert molecules to query format.</p>
</div>
<div class="paragraph">
<p>There is one option, <code>-M nrnr</code> which means that non ring atoms in a query molecule
will only match non ring atoms during a search. But tool <code>mol2qry</code> has a great many
different options for controlling the conversion of a molecule to a query.</p>
</div>
<div class="sect4">
<h5 id="_isotopes">Isotopes</h5>
<div class="paragraph">
<p>Sometimes it is convenient to start with isotopically labelled molecules, which show
the locations at which substitutions are allowed. Adding the <code>-M onlysubiso</code> option
combination tells tsubstructure to use the molecule as a query, but all atoms
without isotopic labels will have the same connectivity as they have in the starting
molecule. Extensions will only be found starting at isotopically labelled atoms.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_query_file">Query file</h3>
<div class="paragraph">
<p>While a smarts provides a compact representation of a set of atoms to be matched. Many
reasonable substructure concepts are very difficult to express via simple atom
matching. For example, 'Fluorine attached somewhere to a benzamidazole', would be
very complex as a smart, but easy with a query file.</p>
</div>
<div class="paragraph">
<p>A query file is based on the Cerius 2 file format. This is an ancient file format. If
this were being done today, we would use a more modern file format such as JSON or
YAML.</p>
</div>
<div class="paragraph">
<p>Some information in a query file is mostly about efficient searching. For example,
if you know the smarts has contains two different aromatic rings, you can specify
that atom mathing should not commence unless the molecule has at least two aromatic
rings.</p>
</div>
<div class="paragraph">
<p>A listing of the available pre atom match directive follows. Most of these directive
can be specified as the name itself, or prefixed with either <code>min</code> or <code>max</code>. In almost
all cases multiple specific values are also accepted. Ranges can be specified by
specifying both a <code>min</code> and a <code>max</code> directive.</p>
</div>
<div class="sect3">
<h4 id="_natoms">natoms</h4>
<div class="paragraph">
<p>Specify the number of atoms a molecule must contain before atom matching is
begun.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  (A I min_natoms 20)</pre>
</div>
</div>
<div class="paragraph">
<p>would only search molecules that contained at least 20 atoms. The combination</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  (A I min_natoms 20)
  (A I max_natoms 40)</pre>
</div>
</div>
<div class="paragraph">
<p>would search only molecules with between 20 and 40 atoms.</p>
</div>
</div>
<div class="sect3">
<h4 id="_nrings">nrings</h4>
<div class="paragraph">
<p>Specify the number of rings the molecule must contain</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  (A I nrings (3 5))</pre>
</div>
</div>
<div class="paragraph">
<p>will only search molecules that have either 3 or 5 rings.</p>
</div>
</div>
<div class="sect3">
<h4 id="_isotopic_atoms">isotopic_atoms</h4>
<div class="paragraph">
<p>Specify the number of isotopic atoms in the molecule</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  (A I isotopic_atoms 1)</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_number_fragments">number_fragments</h4>
<div class="paragraph">
<p>Specify the number of fragments in the molecule</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  (A I max_number_fragments 2)</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_inter_ring_atoms">inter_ring_atoms</h4>
<div class="paragraph">
<p>Specify the number of atoms that are between rings</p>
</div>
</div>
<div class="sect3">
<h4 id="_spinach_atoms">spinach_atoms</h4>
<div class="paragraph">
<p>Specify the number of atoms that are in the molecular 'spinach', or
substituents. Note that in a molecule with no rings, all atoms are
considered to be 'spinach' atoms.</p>
</div>
</div>
<div class="sect3">
<h4 id="_net_formal_charge">net_formal_charge</h4>
<div class="paragraph">
<p>Specify the net formal charge on the molecule. To find a Zwitterion in a
single fragment molecule search for smarts <code>1[<strong>+].[</strong>-]</code>. This will
however find charges separated by one bond. It will also fail if there
are multiple fragments present. In a potentially
multi-fragment molecule, and to enforce a bond separation, use <code>1([+]&#8230;&#8203;{&gt;1}[-])</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_heteroatom_count">heteroatom_count</h4>
<div class="paragraph">
<p>Specify the number of heteratoms a molecule must contain.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  (A I min_heteroatom_count 4)</pre>
</div>
</div>
<div class="paragraph">
<p>Less commonly used. Note that it is possible to define what should be considered
a heteroatom for this comparison.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  (A C define_heteroatoms "F Cl Br I")
  (A I min_heteroatom_count 4)</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_isolated_ring_count">isolated_ring_count</h4>
<div class="paragraph">
<p>The number of ring systems in the molecule</p>
</div>
</div>
<div class="sect3">
<h4 id="_rings_and_ring_systems">Rings and Ring Systems</h4>
<div class="paragraph">
<p>It is possible to perform complex queries on the rings and ring systems in a molecule. It is
important to note that these queries are done prior to, and independent of any atom matching.
Rather than introduce options one at a time, here is an example that contains all possible
directives for a Ring (not a ring system).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  (1 Ring_Specifier
    (A I aromatic 1)
    (A I min_ring_size 6)
    (A I min_heteroatom_count 1)
    (A I max_attached_heteroatom_count 2)
    (A I hits_needed 2)
    (A I min_ncon 3)
    (A I all_hits_in_same_fragment 1)
    (A I strongly_fused_ring_neighbours 0)
    (A C environment "1a-[OH]&amp;&amp;&lt;3c-F")
    (A I environment_can_match_in_ring_atoms 0)
    (A I fused 1)
    (A I fused_aromatic_neighbours 1)
    (A I fused_non_aromatic_neighbours 0)
    (A I largest_number_of_bonds_shared_with_another_ring 1)
    (A I min_atoms_with_pi_electrons 4)
  )</pre>
</div>
</div>
<div class="paragraph">
<p>We are looking for an aromatic ring.  The ring must be of size 6 or
more.  There must be at least one heteroatom in the ring.  There can
be at most two heteroatoms attached to the ring.  There must be two
such rings in the molecule.  There must be at least three connections
outside the ring. All examples found must be in the same fragment.
There must not be any strongly fused neighbours - no cage like structures,
but since we are looking for an aromatic, this is very unlikely.
Attached to this ring must be a Hydroxy <strong>and</strong> fewer than 3 F atoms - which
might include zero. Note that the first atom in the environment
is in the ring. In this case, we direct that environment atoms can
only match atoms outside the ring, but there are special cases where you want
to be able to match atoms in the ring. The ring must be fused. There
must be one fused aromatic neighbour, and no fused non aromatic rings.
Specifying largest_number_of_bonds_shared_with_another_ring as 1 is
somewhat redundant with specifying no strongly fused ring neighbours.
For an aromatic system, specifying min_atoms_with_pi_electrons is
likely redundant.</p>
</div>
<div class="paragraph">
<p>Across Pubchem, there are 4733 molecules that match this query. Here is the smallest
match</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./Images/ring0_00001.png" alt="RingMatch" width="500" height="400"></span></p>
</div>
<div class="paragraph">
<p>For a ring system, there are some extra specifications possible.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  (1 Ring_System_Specifier
    (A I min_rings_in_system 3)
    (A I ring_sizes (3 6 7 8))
    (A I min_aromatic_ring_count 1)
    (A I max_aromatic_ring_count 3)
    (A I max_degree_of_fusion 2)
    (A I max_atoms_in_system 50)
    (A I number_spinach_groups 3)
    (A I number_non_spinach_groups 3)
    (A I max_length_of_spinach 5)
    (A I min_distance_to_another_ring 4)
  )</pre>
</div>
</div>
<div class="paragraph">
<p>Here are examples of what matches from Pubchem</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./Images/ring_system0_00001.png" alt="RingSystemMatch1"></span>
<span class="image"><img src="./Images/ring_system0_00002.png" alt="RingSystemMatch2"></span></p>
</div>
<div class="paragraph">
<p>Note that a spiro fused ring is treated rather specially. It is not part of the ring
system, but it is not counted as part of the spinach. But it does count as two
connections to non-spinach groups. Just beware that spiro fused groups can create
many kinds of problems. Perhaps there should be a different default.</p>
</div>
<div class="paragraph">
<p>Because we specified <code>max_degree_of_fusion</code> the largest number of rings joined to
any other ring will be two.</p>
</div>
<div class="paragraph">
<p>The ring sizes directive is interesting. This lets you specify a list of ring
sizes that should be present in the ring system. If any ring of a size not listed
is encountered, that ring system is not matched. But the system does not
force every ring specified to be present. Perhaps that would be a better approach,
since right now there is no easy way of saying you want a 5-6 aromatic system.
Perhaps a <code>specific_ring_sizes</code> directive should be implemented, so something like</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  (A I specific_ring_sizes (5 5 6))</pre>
</div>
</div>
<div class="paragraph">
<p>would find ring systems with three rings, two of which had 5 atoms and one of which
had 6 atoms. This would be possible using smarts, but is clumsy. The smarts</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[/IWfss3/IWfsid1/IWrid1r5].[/IWfsid1/IWrid2r5].[/IWfsid1/IWrid3r6]</pre>
</div>
</div>
<div class="paragraph">
<p>will match
<span class="image"><img src="./Images/rid1_00001.png" alt="RingId1" width="500" height="400"></span>
but this is very cumbersome.</p>
</div>
<div class="paragraph">
<p>As an explanation, we first specify a fused system size
of 3, and establish a fused system identifier of 1. Then we look for a ring of size 5
with rind identifier 1. Then, within the same fused system id of 1, we look for a different
ring, rid2, of size 5. Then similar for the ring of size 6.</p>
</div>
<div class="paragraph">
<p>The <code>distance_to_another_ring</code> directive is also complex. If either min or max is
specified, then any instance of a ring violating the constraints will result in a
rejection. But if only specific values are entered, then if the molecule contains
a single example of those specifications, then a match will be reported.</p>
</div>
<div class="paragraph">
<p>The directive <code>ncon_ignore_singly_connected</code> says that when the ncon variable is
computed for a ring, or ring system, discard singly connected atoms attached
to the ring. This may no longer be useful.</p>
</div>
<div class="paragraph">
<p>Both <code>Ring_Specifier</code> and <code>Ring_System_Specifier</code> objects can be joined via logical
expressions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  (1 Ring_Specifier
    (A I aromatic 1)
    (A I ring_size 6)
    (A I heteroatom_count 3)
  )
  (2 Ring_Specifier
    (A I aromatic 0)
    (A I ring_size 8)
    (A I min_heteroatom_count 4)
    (A C operator "or")
  )</pre>
</div>
</div>
<div class="paragraph">
<p>which may not make much chemical sense. The default operator is the <code>and</code> operator. Note that
the operator is specified with the second, and subsequent, object(s).</p>
</div>
<div class="paragraph">
<p>Both Ring_Specifier and Ring_System_Specifier objects can have a <code>rejection</code> attribute,
in which case molecules containing a matching ring or ring system will <strong>not</strong> be matched.</p>
</div>
</div>
<div class="sect3">
<h4 id="_elements_needed">Elements Needed</h4>
<div class="paragraph">
<p>This is mostly for efficiency. If you know a query involves three different Oxygen atoms,
we can tell the query to only search molecules with at least three Oxygen atoms</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  (3 elements_needed
    (A I atomic_number 8)
    (A I min_hits_needed 2)
  )</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conditions_on_matches_found">Conditions on Matches Found</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Just as it is possible to place conditions on the molecule before atom matching begins,
it is possible to place constraints on the kinds of matches found. Atom embeddings that do not
match these conditions will be discarded, and no match reported.</p>
</div>
<div class="sect2">
<h3 id="_max_matches_to_find">max_matches_to_find</h3>
<div class="paragraph">
<p>Stop searching after a specified number of matches have been identified.</p>
</div>
</div>
<div class="sect2">
<h3 id="_subtract_from_rc">subtract_from_rc</h3>
<div class="paragraph">
<p>For any given number of matches found, we can simply discard a number of matches. This is useful
in cases like the medchem rules, where we want to demerit things like instances of CF3 beyond
two in a molecule.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  (A I subtract_from_rc 2)</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ring_atoms_matched">ring_atoms_matched</h3>
<div class="paragraph">
<p>If a query contains unspecified atoms, you migh still want (say) at least two of the matched
atoms to be ring atoms.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  (A I min_ring_atoms_matched 2)</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_distance_between_hits">distance_between_hits</h3>
<div class="paragraph">
<p>You may want to ensure that matches are in separate parts of the molecule. Note that across
the matched atoms, the shortest bond distance is the distance used. If a new embedding is found
to be too close to an already found embedding, it will be discarded. Note that embeddings will
be found based on atom order in the target molecule, so different results may be possible
with different orderings of the input molecule.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  (A I min_distance_between_hits 4)</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fail_if_embeddings_too_close">fail_if_embeddings_too_close</h3>
<div class="paragraph">
<p>Alternatively we may want to report no matches at all if any two matches violate
the <code>distance_between_hits</code> directive</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  (A I min_distance_between_hits 4)
  (A I fail_if_embeddings_too_close 1)</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_embeddings_to_not_overlap">embeddings_to_not_overlap</h3>
<div class="paragraph">
<p>By default, embeddings are found independetly.  This directive will discard subsequent embeddings
found that include any atom previously matched by another embedding.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  (A I embeddings_to_not_overlap 1)</pre>
</div>
</div>
<div class="paragraph">
<p>It is a historical accident that this is a negative selector.</p>
</div>
</div>
<div class="sect2">
<h3 id="_min_fraction_atoms_matched_max_fraction_atoms_matched">min_fraction_atoms_matched, max_fraction_atoms_matched</h3>
<div class="paragraph">
<p>Sometimes it is useful to put constraints on the fraction of the atoms in the molecule that
are matched by substructure matched atoms.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  (A D min_fraction_atoms_matched 0.5)</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_element_hits_needed">element_hits_needed</h3>
<div class="paragraph">
<p>For each embedding, specify that certain numbers of elements must be among the matched atoms.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  (1 element_hits_needed
    (A I atomic_number 8)
    (A I min_hits_needed 2)
  )</pre>
</div>
</div>
<div class="paragraph">
<p>Contrast this with the <code>elements_needed</code> directive, which is applied to the molecule before
matching begins.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_query_atoms">Query Atoms</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Smarts provides a convenient way of specifying the atoms to be matched, and the connections
between them. A smarts can be used in a query file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  (A I version 2)
  (A C Comment "aromatic")
  (A C smarts "a1aaaaa1")</pre>
</div>
</div>
<div class="paragraph">
<p>Will find 6 membered aromatic rings. If we want to find all variants that have or more heteroatoms,
we can use.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  (A C smarts "a1aaaaa1")
  (A I min_heteroatoms_matched 2)</pre>
</div>
</div>
<div class="paragraph">
<p>To make that an isolated ring</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  (A C smarts "[/IWfss1a]1aaaaa1")
  (A I min_heteroatoms_matched 2)</pre>
</div>
</div>
<div class="paragraph">
<p>We might want to heave at least two connections off this ring.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  (A C smarts "[/IWfss1a]1aaaaa1")
  (A I min_heteroatoms_matched 2)
  (A I min_ncon 2)</pre>
</div>
</div>
<div class="paragraph">
<p>We may want a halogen substituent, and NOT a nitro</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  (A C smarts "[/IWfss1a]1aaaaa1")
  (A I min_heteroatoms_matched 2)
  (A I min_ncon 2)
  (1 Environment
    (A I single_bond (0 1 2 3 4 5))
    (A C smarts "[F,Cl,Br,I]")
  )
  (2 Environment_no_Match
    (A I single_bond (0 1 2 3 4 5))
    (A C smarts "N(=O)=O")
  )
)</pre>
</div>
</div>
<div class="paragraph">
<p>Environments are powerful means of controlling query matches. Unlike the environments used
with <code>Ring_Specifier</code> and <code>Ring_System_Specifier</code> objects, the first atom here does <strong>not</strong>
include the already matched atom. By default, the environment will only match unmatched
atoms, although this can be controlled via a command line option, <code>-M aecmm</code>.</p>
</div>
<div class="paragraph">
<p>Multiple smarts can be added within an environment and are executes with an implicit <strong>or</strong>
operator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  (1 Environment
    (A I single_bond (0 1 2 3 4 5))
    (A C smarts "F")
    (A C smarts "1[Cl,Br,I]")
  )</pre>
</div>
</div>
<div class="paragraph">
<p>Which specifies either 1 heavy halogen, or any number of Fluorine subsituents.</p>
</div>
<div class="paragraph">
<p>Environments can be combined via an <strong>or</strong> operation rather than the default <strong>and</strong> operation.
In this case, each operator is identified by a number. Environments with the same number
participate in the same logical grouping.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(0 Query
  (A I version 2)
  (A C Comment "aromatic")
  (A C smarts "[/IWfss1a]1aaaaa1")
  (A I min_heteroatoms_matched 2)
  (A I min_ncon 2)
  (1 Environment
    (A I single_bond (0 1 2 3 4 5))
    (A C smarts "F")
    (A I min_hits_needed 2)
    (A I or 1)
  )
  (2 Environment
    (A I single_bond (0 1 2 3 4 5))
    (A C smarts "N(=O)=O")
    (A I hits_needed 1)
    (A I or 1)
  )
)</pre>
</div>
</div>
<div class="paragraph">
<p>Yields molecules like</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./Images/or_environment_00001.png" alt="OrEnvironment1" width="300" height="250"></span>
<span class="image"><img src="./Images/or_environment_00002.png" alt="OrEnvironment2" width="300" height="250"></span></p>
</div>
<div class="paragraph">
<p>While these examples have used a smarts to specify the query atoms, these too can be
specified in query format instead.</p>
</div>
<div class="sect2">
<h3 id="_preferences">Preferences</h3>
<div class="paragraph">
<p>When there are multiple matches to a query, it can be useful to sort those matches so more
desirable matches are reported ahead of less desirable matches. Sometimes this can be
accomplished just by using or queries. For example, to find a primary amine before a
secondary amine, the smarts <code>[ND1H2]-[CT1G0]||[ND2HT0](-[CX4T1])-[CX4T1]</code> might suffice.
Note that the Nitrogen atom is the first atom in the query in each case.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_query_atom_specifications">Query Atom Specifications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are a range of atom specifications possible</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">atomic_number</dt>
<dd>
<p>the atomic number of the atom  single values only, no min_ or max_ possible. A halogen would be (A I atomic_number (9 17 35 53))</p>
</dd>
<dt class="hdlist1">ncon</dt>
<dd>
<p>the number of explicit connections. If you are searching a molecule with explicit Hydrogen atoms, those atoms are will count.</p>
</dd>
<dt class="hdlist1">nbonds</dt>
<dd>
<p>the number of explicit bonds to the atom. Double bonds count as 2 and triple bonds as 3. Implicit Hydrogens are ignored, explicit Hydrogens are counted. If the atom is aromatic, the bonds in the Kekule representation are counted.</p>
</dd>
<dt class="hdlist1">formal_charge</dt>
<dd>
<p>the explicit formal charge on the atom</p>
</dd>
<dt class="hdlist1">nrings</dt>
<dd>
<p>the number of Smallest Set of Smallest Rings (SSSR) rings the atom is in. Beware molecules like cubane which has 5 SSSR rings rather than 6.</p>
</dd>
<dt class="hdlist1">ring_size</dt>
<dd>
<p>the atom must be in a ring of the specified size  it may also be in rings of other sizes too.</p>
</dd>
<dt class="hdlist1">hcount</dt>
<dd>
<p>the number of explicit and implicit Hydrogen atoms bonded to the atom.</p>
</dd>
<dt class="hdlist1">aromatic</dt>
<dd>
<p>whether or not the atom is aromatic</p>
</dd>
<dt class="hdlist1">aromatic_ring_size</dt>
<dd>
<p>the atom must be in an aromatic ring of given size</p>
</dd>
<dt class="hdlist1">aliphatic_ring_size</dt>
<dd>
<p>the atom must be in an aliphatic ring of given size</p>
</dd>
<dt class="hdlist1">attached_heteroatom_count</dt>
<dd>
<p>the number of heteroatoms connected to the atom</p>
</dd>
<dt class="hdlist1">lone_pair_count</dt>
<dd>
<p>the number of lone pairs on the atom</p>
</dd>
<dt class="hdlist1">unsaturation</dt>
<dd>
<p>nbonds  ncon. Note that a triple bond counts 2</p>
</dd>
<dt class="hdlist1">daylight_x</dt>
<dd>
<p>the same as the X directive in smarts  the total number of connections, including implicit Hydrogens.</p>
</dd>
<dt class="hdlist1">isotope</dt>
<dd>
<p>isotopic label. Note that min_ and max_ constructs are allowed.</p>
</dd>
<dt class="hdlist1">aryl</dt>
<dd>
<p>whether or not an aromatic environment is bonded.</p>
</dd>
<dt class="hdlist1">vinyl</dt>
<dd>
<p>is there a vinyl environment attached</p>
</dd>
<dt class="hdlist1">fused_system_size</dt>
<dd>
<p>the atom must be in a fused system with this many rings.</p>
</dd>
<dt class="hdlist1">carbocycle</dt>
<dd>
<p>is the atom in a carbocycle</p>
</dd>
<dt class="hdlist1">ncon2</dt>
<dd>
<p>seldom used, may be removed in future. The sum of ncon values for the atom as well as its directly attached neighbours.</p>
</dd>
<dt class="hdlist1">ring_id</dt>
<dd>
<p>Sometimes it is important that matched atoms be in specific rings  the same ring as another matched atom, or in a different ring than another matched example.</p>
</dd>
<dt class="hdlist1">fragment_id</dt>
<dd>
<p>Used to specify any fragment information. Atoms with the same fragment id must be in the same fragment. Atoms with different values must be in different fragments.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_parallel">Parallel</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two parallel versions of tsubstructure.</p>
</div>
<div class="sect2">
<h3 id="_tsubstructure_parallel">tsubstructure_parallel</h3>
<div class="paragraph">
<p>Uses multiple cores on the same computer. Specify the number of threads via the -thr option. All tsubstructure
options are supported.</p>
</div>
</div>
<div class="sect2">
<h3 id="_qsub_tsubstructure">qsub_tsubstructure</h3>
<div class="paragraph">
<p>Uses the cluster. Operates over a set of pre-split files, typically generated by iwsplit. You must specify
the stem of that set of files via the -stem option</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-12-11 15:01:36 EST
</div>
</div>
</body>
</html>